---
import { getCollection, type CollectionEntry, render } from "astro:content";
import Layout from "../../../layouts/Layout.astro";
import "../../../styles/global.css";
import CardButton from "../../../components/CardComponents/CardButton.astro";
import { getLangFromUrl, useTranslations } from "../../../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

export async function getStaticPaths() {
  const projects = await getCollection(
    "projects",
    (entry: CollectionEntry<"projects">) => {
      return entry.data.lang === "en";
    }
  );

  return projects.map((project: { slug: any }) => ({
    params: { id: project.slug },
    props: { project },
  }));
}

type Props = {
  project: CollectionEntry<"projects">;
};

const { project } = Astro.props;
const { data, slug } = project;

const { title, description, tags, img, link, github } = data;
const { Content } = await render(project);
export const prerender = true;
---

<Layout title={title}>
  <main class="container mx-auto px-4 py-8 md:py-12 min-h-[calc(100vh-200px)] flex flex-col">
    <!-- Header Section -->
    <div class="mb-8 md:mb-12">
      <h1
        transition:name={`title-${slug}`}
        class="text-4xl md:text-6xl font-bold text-center mb-2 bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent"
      >
        {title}
      </h1>
      <div class="h-1 w-20 bg-gradient-to-r from-blue-500 to-purple-500 mx-auto mt-4"></div>
    </div>

    <!-- Main Content -->
    <article class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12 items-start">
      <!-- Image Section -->
      <figure class="flex flex-col items-center justify-center">
        <div class="w-full max-w-md rounded-lg overflow-hidden shadow-lg hover:shadow-2xl transition-shadow duration-300">
          <img
            transition:name={`img-${slug}`}
            src={`/${img}`}
            alt={title}
            class="w-full h-auto object-cover"
          />
        </div>
      </figure>

      <!-- Content Section -->
      <div class="flex flex-col justify-center gap-6">
        <!-- Description -->
        <div class="bg-gray-50 rounded-lg p-6 md:p-8">
          <p class="text-lg md:text-xl leading-relaxed text-gray-700">
            <Content />
          </p>
        </div>

        <!-- Tags Section -->
        <div class="flex flex-wrap gap-2 justify-center md:justify-start">
          {tags.map((tag: string) => (
            <span class="px-4 py-2 bg-blue-100 text-blue-800 rounded-full text-sm font-semibold border border-blue-200 hover:bg-blue-200 transition-colors duration-200">
              {tag}
            </span>
          ))}
        </div>

        <!-- Action Buttons -->
        <div class="flex flex-col sm:flex-row gap-4 justify-center md:justify-start pt-4">
          <CardButton link={link}>{t("card.project.btn.link")}</CardButton>
          <CardButton link={github}>{t("card.project.btn.code")}</CardButton>
        </div>
      </div>
    </article>
  </main>
</Layout>
